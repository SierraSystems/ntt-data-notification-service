[![Test Coverage](https://api.codeclimate.com/v1/badges/b6bb35624e04cdfb7364/test_coverage)](https://codeclimate.com/github/SierraSystems/ntt-data-notification-service/test_coverage) [![Maintainability](https://api.codeclimate.com/v1/badges/b6bb35624e04cdfb7364/maintainability)](https://codeclimate.com/github/SierraSystems/ntt-data-notification-service/maintainability)

# ntt-data-notification-service

A Service that pushes notifications to different chat platforms.

Currently, this application supports Splunk as an alert source, and MSTeams and RocketChat as notification destinations.

Teams notification screenshot:

![teams-message](docs/images/teams-notification.png)

## Usage

In order to use this application, a client requires a token (set in the applications env), and webHook URL(s) for supported chat apps.

### URL Generation

Once a token has been added/provided, navigate to the notification service (if running locally via docker `http://localhost:6000/alert`)

![ntt](https://user-images.githubusercontent.com/28017034/83478036-a8378480-a449-11ea-96fb-83a4e58c5004.PNG)

Enter the provided token and the webHook url(s) notifications should be sent to. Click `Generate URL` to create a url containing the information required by the service to post to the provided webHook url(s). This URL will need to be regenerated and updated in Splunk when a chat destination needs to be added or removed. (If running locally via docker, the `localhost:port` part of the url will need to be changed to `172.20.0.6:8080`)

### Splunk WebHook Setup

The URL generated in the frontend is required to setup alerts in Splunk.

Use the following steps to set up a test alert:

1. Navigate to your Splunk instance and log in (if running locally via docker `http://localhost:7000`, with username/password of admin/TestTest).

2. To try out an example log, type the following as a search in Splunk:
```bash
index=_audit  action=search
| eval message = "Insert action required for error"
| table message source info
```

3. Click <b>Save As</b> and select <b>Alert</b>.

4. Provide a title, set it to run on a cron schedule and provide a valid cron expression as per your frequency needs.

<img width="540" alt="alertsettings1" src="https://user-images.githubusercontent.com/28017034/82948601-e965fb00-9f56-11ea-93cd-7c81dd0bfc9a.PNG">

5. Add actions:
```
Webhook
Add to Triggered Alerts
```

<img width="498" alt="settings2" src="https://user-images.githubusercontent.com/28017034/82948608-ec60eb80-9f56-11ea-90e8-b1bbf4a17190.PNG">

6. In the Webhook action, paste in the URL generated by the frontend.

7. Press <b>Save</b>.

8. Click <b>View Alert</b>.

<b>NOTE:</b> Make sure to remove this alert once done testing as it is only intended for ensuring connectivity between Splunk, the notification service, and the chat platform(s).


## Running Locally

```bash
docker-compose up --build ntt-data-notification-service
```

This should spin up the ntt-data-notification-service and the latest docker image of Splunk locally.

To modify the ports the app is running on, simply change the port mappings in the docker-compose file.

Optional: If not running the application through docker, you can set a property in `application.properties` if you would like to customize the port your app runs on:
```bash
server.port=${PORT:<PORT>}
```
